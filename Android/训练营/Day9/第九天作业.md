# 第九天作业

![image-20240714155718993](https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240714155718993.png)

## 1、完成搜索功能，将搜索结果使用列表展示，支持页面下拉刷新和上拉加载更多；使用`OkHttp`和`Retrofit`两种方式进行网络请求

**注意**：使用MMKV保存最后一次刷新的数据，首次启动直接使用MMKV里的数据，如果没有发起网络请求

### **实现过程**：

1. **初始化 MMKV：**
   - 首先调用 `MMKV.initialize` 方法进行 MMKV 的初始化。
   - 然后获取默认的 MMKV 实例以便后续使用。
2. **设置 `RecyclerView`：**
   - 初始化 `SearchResultAdapter` 并将其设置为 `RecyclerView` 的适配器，以显示搜索结果。
   - 配置 `RecyclerView` 的加载更多监听器，使用户在上拉时能够加载更多数据。
3. **设置搜索监听器：**
   - 为 `EditText` 设置动作监听器，当用户输入搜索内容后按下搜索按钮时触发搜索操作。
   - 在触发搜索操作后，调用 `hideKeyboard` 方法隐藏软键盘。
4. **加载缓存数据：**
   - 从 MMKV 中读取缓存的游戏数据，并将其解析为 `HttpBean<GameBean.Data>` 类型。
   - 如果缓存数据存在，则更新 `gameList` 并通知适配器刷新数据。
5. **搜索游戏：**
   - 定义 `searchGames` 方法，通过 `ApiServiceModule` 发起网络请求以获取游戏数据。
   - 在请求成功时，清空现有数据并更新为新数据，同时将新数据缓存。
   - 在请求失败时，加载缓存数据并显示错误信息。
6. **加载更多游戏：**
   - 定义 `searchMoreGames` 方法，通过 `ApiServiceModule` 发起网络请求以加载更多游戏数据。
   - 使用 `Handler` 引入 1 秒的延迟模拟加载过程。
   - 在请求成功时，将新数据追加到现有数据中。
   - 在请求失败时，显示错误信息。
7. **缓存数据：**
   - 定义 `cacheData` 方法，将 `HttpBean<GameBean.Data>` 对象序列化为 JSON 字符串并保存到 MMKV 中，以便后续读取使用。

**使用日志拦截器`HttpLoggingInterceptor`查看刷新以及查询请求过程**：

![image-20240714230908041](https://cdn.jsdelivr.net/gh/kennems/blog-image/image-20240714230908041.png)

### 演示视频：

[./录制MP4视频/SearchGameInfo.mp4](./录制MP4视频/SearchGameInfo.mp4)

<video src="./录制MP4视频/SearchGameInfo.mp4" controls style="width: 100%; height: auto;"></video>





