# 互联网编程实践

**需要软件：**

- Myeclipse （jdk+tomcat9)


- 数据库（阿里云服务器）


- JDBC驱动程序（mysql connector java 8.0.11.jar)


- 浏览器


## Myelicpse使用流程

1. 打开修改路径
2. 新建Web Project
3. **JAVA EE7 3.1** JDK1.8 **JSTL version 1.2.4**
4. 

在应用程序中用Java代码访问数据库，连接字符串：

```web
Url="jdbc:mysql://<Host>:<Port>/<myDatabase>"
```

```jsp
<%@ page contentType="text/html; charset=GB2312"  language="java" import="java.util.*"%>
<!--设置页面内容类型为HTML格式，字符集为GB2312。-->
<html>
<head>
    <title>我的第一个JSP例子</title>
    <!--网页标题为“我的第一个JSP例子”。-->
</head>
<body>
<table align="center">
    <h3>温馨提示：</h3>
    <!--添加一个表格及表头，提示用户。-->
    <tr><td><%
        //获得当前的时间
        Date today = new Date();
        //获取当前日期信息。
        out.print("现在是北京时间："+today);
        //打印当前日期信息到页面。
    %></td></tr>
    <tr><td>
        <%
            //获得当前时间中的小时
            int hour = today.getHours();
            //获取当前小时数。
            if(0<=hour&&hour<=5){
                out.print("现在是北京时间凌晨 "+hour+"点"); } 
            else if(5<hour&&hour<=10){
                out.print("早上 "+hour+"点");}
            else if(10<hour&&hour<13){
                out.print("中午 "+hour+"点");}
            else if(13<=hour&&hour<18){
                out.print("下午 "+hour+"点");}
            else if(18<=hour&&hour<21){
                out.print("晚上 "+hour+"点");}
            else if(21<=hour&&hour<24){
                out.print("深夜 "+hour+"点");}
            //根据小时数，输出相应的问候语。
        %>
    </td></tr>
</table>
<!--关闭表格。-->
</body>
</html>
<!--结束HTML页面。-->
```

服务器

我的外网地址

```web
rm-cn-x0r36bg4d00156ko.rwlb.rds.aliyuncs.com
```

 JDBC拷贝路径

```
D:\Workspaces\.metadata\.me_tcat9046\webapps\FirstJSP\WEB-INF\lib
```

```jsp
<%@ page contentType="text/html; charset=GB2312" import="java.sql.*"%>
<!--设置页面内容类型为HTML格式，字符集为GB2312，导入Java.sql包。-->
<html>
<head><title>建立数据表Student</title></head>
<!--网页标题为“建立数据表Student”。-->
<body>
<%
    //加载MySQL数据库驱动程序。
    Class.forName("com.mysql.jdbc.Driver");
    //设置连接数据库的URL。
    String url = "jdbc:mysql://rm-cn-x0r36bg4d00156ko.rwlb.rds.aliyuncs.com:3306/230415test";
    //获取数据库连接。
    Connection con = DriverManager.getConnection(url,"kennem", "ty20230415+");
    //创建语句对象。
    Statement stmt = con.createStatement();
    //定义SQL语句创建学生数据表。
    String SQL = "CREATE TABLE student (" +
            "Sno char(20) PRIMARY KEY," +
            "Sname char(10) NOT NULL," +
            "Ssex char(1) NOT NULL," +
            "Birthyear int NOT NULL," +
            "Smajor char(20) NOT NULL);";
    //执行SQL语句，创建学生数据表，并返回操作结果。
    boolean temp_bool = stmt.execute(SQL);
    //关闭语句对象。
    stmt.close();
    //关闭数据库连接。
    con.close();
%>  
<!--在页面中输出数据表创建成功的信息。-->
<P>数据表Student创建成功！
</body>
</html>
<!--结束HTML页面。-->

```

## JSP & JAVA 语法学习

### 1、基本标记语言 & 文本标记

```jsp
<%@ page pageEncoding="utf-8"%>
<html>
    <head>
        
    </head>
    <body>
        text="#000000" <!--设定文字颜色-->
        link="#0000FF"  <!--设定文字链接颜色-->
        alink="#FF0000" <!--设定链接被按下时的颜色-->
        vlink="#0000FF" <!-- 设定链接被按过后的颜色-->
        background = "bg1.gif" <!--bg1.gif-->
        bgcolor="#FFFF" <!--设定背景颜色-->
        leftmargin=2 <!--设定左边沿宽度，单位位像素-->
        
        <!--文本标记-->

        <p> 
        <!--一段文字-->
        </p>
        
        <div>
        <!--网页内容中的一个独立快-->
        </div>
        
        <br> <!--换行标记-->
        <hr> <!--水平线-->
        <font> <!--用于设置文本字体--> </font>
        <b> 粗体文本 </b>
        <i> 斜体文本 </i>
        <h1>
            可以是1-6级别标题
        </h1>
    </body>
</html>
```

### 2、列表标记 & 表格

```jsp
<ul> 
未排序列表
常用参数：
type 用于设定符号样式，disc实心，circle空心，
</ul>

<ol>
排序列表：
type用于设定编号样式（1，A，a，I,i）
start用于设定起始编号
</ol>

<li> 
列表中的项目
</li>

<table>
	表格起始和结束标记
	<tr>
		表格中的行
		<td>
			表格中的行
		</td>
		<th>
			表头，作用：<td>+粗体
		</th>
		
		<caption>
			表格标题
		</caption>
	</tr>
	常用参数：
		width :设定表格宽度，绝对和相对值
		border ：设定表格边框宽度
		cellspacing 设定表格单元格之间的间隔
		align 表格摆放水平位置(left right center)
		valign 表格中元素摆放的垂直位置 （top,middle,bottom)
		background 设定表格的的背景图片
		bgcolor 设定表格的背景颜色
		bordercolor 设定表格的边框颜色
			<tr>
				常用参数
				align 设定表格中一行内元素摆放的水平位置 lift center right
				valign 设定表格中一行内元素摆放的处置位置 top middle bottom
				bgcolor 设定表格一行的背景颜色
				bordercolor 设定表格中一行的边框颜色
			<\tr>
			<td>
			width 设置表格宽度，绝对值，或相对值
			height 设定表格的高度
			colspan 设定水平跨越的单元格数
			rowspan  设置单元格内元素摆放的水平位置
			align 设定单元格元素的摆放的水平位置 left center right 
			valign 设置单元格的背景颜色
			background 设定该单元格的背景图片
			bgcolor 设定该单元格的背景颜色
			bordercolor 设定该单元格的边框颜色
			</td>
			<caption>
				align 设定表格标题行相对于表格的水平位置 left center right 
				valign 设定表格标题的处置位置 top middle bottom
			</caption>
</table>
```

### 5、表单标记 & 其他标记

```jsp
		<form>
<!-- 			表单起始和结束标记 -->
<!-- 			常用参数： -->
<!-- 				action 指定处理表单数据的应用程序的位置 -->
<!-- 				method 指定表单传输数据的方式（get或者post） -->
<!-- 					get和post区别：get方式参数串附在网址后面，而post的参数串附在网址后。 -->
			<input> 
<!-- 				表单中的输入字段 -->
<!-- 				Text 单行文本框， -->
				 <input type="Text" name="userid" value="" size="20" maxlength="16">
<!-- 				Radio 单选按钮 -->
				 <input type="Radio" name="sex" value="男" checked> 男 <br>
				 <input type="Radio" name="sex" value="女"> 女
<!-- 				Checkbox 复选框 -->
				 <input type="Checkbox" name="sports hobby" value="football" checked>足球<br>
				 <input type="checkbox" name="sports hobby" value="volleyball">排球<br> 
<!-- 				Password 密码框 -->
				 <input type="Password" name="password" value="123456" size="20" maxlength="16">
<!-- 				Submit （传送）及Reset（清除按钮） -->
				 <input type="Text" name="userid" size="20"> <br>
				 <input type="Submit" value="确定" > &nbsp; 
				 <input type="Reset" value="清除">
				 
			</input>
			<select>
<!-- 				表单中的选择列表 -->
<!-- 				常用参数： -->
<!-- 					name 设定选择列表的名称 -->
<!-- 					size 设定多显示出的选项的数量，即高度 -->
<!-- 					mutiple 设定选择列表允许有多重选择 -->
			</select>
			<option>
<!-- 				选择列表中的选项 -->
<!-- 				常用参数： -->
<!-- 					value 设定该选项的值 -->
<!-- 					selected 设定该选项被选中 -->
			</option>
			<textarea>
<!-- 				可滚动的多行文本框 -->
<!-- 				常用参数： -->
<!-- 					name  设定多行文本字段的名称 -->
<!-- 					cols 设定每行容纳多少字符 -->
<!-- 					rows 设定显示多少行 -->
			</textarea>
		</form>
<!-- 		其他标记 -->
		<img>
<!-- 			src 设定图片的来源 接受.gif .jpg .png 可以设定绝对以及相对路径。 -->
<!-- 			width 设定图片宽度，一般以pixels为单位。 -->
<!-- 			height 设定图片高度， 一般以pixels为单位 -->
<!-- 			hspace 设定图片左右空间，一般以pixels为单位 -->
<!-- 			vspace 设定图片上下空间，一般以pixels为单位 -->
<!-- 			border 设定图片边框的宽度 -->
		<a>
<!-- 			链接 -->
<!-- 			href 设定链接到的文件名称 -->
<!-- 			target 设定链接被按后结果所要显示的视窗 -->
<!-- 			 可选值   _blank 新开一个窗口 -->
<!-- 			 		_parent 在框架的父框架或父窗口 -->
<!-- 			 		_self 在原窗口或框架本身 -->
<!-- 			 		_top 在顶层窗口 （会清楚框架） -->
		</a>
		<map>
<!-- 			图像地图 -->
					name 标识该地图
					
		</map>
		<area>
<!-- 			图像地图中的区域 -->
<!-- 					href 该区域所链接到的文件名称， 可与设定绝对及相对路径 -->
<!-- 					shape 设定该区域的形状（rect,circ,poly） -->
		</area>
		<style>
/* 			样式 */
		</style>
		<frameset>
<!-- 			一组框架 -->
<!-- 					cols 垂直分割 -->
<!-- 					rows 水平分割 -->
<!-- 					frameborder 设定框架是否有边框 0没有1有 -->
<!-- 					border 设定框架的边框厚度 -->
<!-- 					bordercolor 设定框架的边框颜色 -->
<!-- 					framespacing 设定框架之间的间隔 -->
		</frameset>
		<frame>
<!-- 			框架组中的一个 -->
<!-- 					src 设定框架内的要显示的网页文件名称 -->
<!-- 					scrolling 设定是否滚动显示（yes no auto）  -->
		</frame>
```

## JAVA语法

基本语法和c++类似

JAVA仅支持单一继承

### 类、对象、包、接口

类

```java
class Point{
	int x,y;
	void init(int p_x,int p_y){
		x=p_x; y=p_y;
	}
}
```

成员变量

```java
type variableName;
```

### index.jsp

```jsp
<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>

<%
// 获取 web 应用在服务器上的部署路径
String path = request.getContextPath();
// 构造 web 应用的基础访问路径，包括协议、主机名、端口号和应用路径
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <!-- 设置页面中各种头信息 -->
    <base href="<%=basePath%>"> <!-- 指定页面中的所有相对 URL 的基准路径 -->
    
    <title>My JSP 'index.jsp' starting page</title>
	<meta http-equiv="pragma" content="no-cache"> <!-- 禁止缓存 -->
	<meta http-equiv="cache-control" content="no-cache"> <!-- 禁止缓存 -->
	<meta http-equiv="expires" content="0"> <!-- 禁止缓存 -->    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3"> <!-- 页面关键词 -->
	<meta http-equiv="description" content="This is my page"> <!-- 页面描述 -->
	<!--
	<link rel="stylesheet" type="text/css" href="styles.css"> 
	-->
  </head>
  
  <body>
    This is my JSP page. <br>
  </body>
</html>
```



## 实例程序A

### Class

#### conClass.java

```java
//conClass
// 定义一个名为 conClass 的 Java 类
package demo;

public class conClass {
	
    // 定义一个名为 tochinese 的静态方法，用于将 ISO-8859-1 编码格式的字符串转换成 utf-8 编码格式的字符串
	public static String tochinese(String str)
	{
        try{
            // 将源字符串转换成字节数组，编码格式为 ISO-8859-1
			byte s[]=str.getBytes("ISO-8859-1");
			// 将字节数组转换成字符串，编码格式为 utf-8
			str = new String(s,"utf-8");
			// 返回最终得到的字符串
			return str;
		}
        // 如果出现异常，则返回原始的字符串
		catch(Exception e)
		{ return str;}
	}

}
```

#### sqlBean.java

```java
package demo;

import java.util.*;
import java.sql.*;

public class sqlBean {
	
	 private Connection con = null;
	 
	 public Statement getStatement(){  
		 Statement stmt=null;
		 try{ 
			 //加载MySql的驱动类 
			 Class.forName("com.mysql.jdbc.Driver"); 
			 }
         catch(ClassNotFoundException e){ 
			 System.out.println("找不到驱动程序类 ，加载驱动失败！"); 
			 e.printStackTrace() ; 
			 }
		 //连接MySql数据库，云数据库端口：3306
		 //数据库名：db_1
		 //用户名sa和密码Sa123456 
		  String url =  "jdbc:mysql://rm-cn-x0r36bg4d00156ko.rwlb.rds.aliyuncs.com:3306/db_1" ;  
		  String username = "kennem2" ; 
		  String password = "ty20230415+" ; 
		  try{ 
		 	con =DriverManager.getConnection(url,username,password); 
		  }catch(SQLException se){ 
		 	System.out.println("数据库参数错误，连接失败！"); 
		 	se.printStackTrace() ; 
		  }
		  try {  
	        stmt=con.createStatement();
	      }
          catch(Exception e){  
	         System.out.println("数据库连接失败!!!"+e.getMessage());  
	      }  
	        return stmt;  
	    }  
	 /** 
     * 执行sql语句的数据库查询 
     * @param sql 
     * @return 
     */  
    public ResultSet executeQuery(String sql){  
        ResultSet rs=null;  
        try {  
            rs=getStatement().executeQuery(sql);  
        } catch (SQLException e) {  
            e.printStackTrace();  
            System.out.println("数据库查询失败!!!"+e.getMessage());  
        }  
        return rs;  
    }  
    /** 
     * 执行sql语句的数据库更新(增删改)
     */  
    public int executeUpdate(String sql){  
        int i=0;  
        try {  
            i=getStatement().executeUpdate(sql);  
        } catch (SQLException e) {
            e.printStackTrace();  
            System.out.println("执行数据库操作错误!!!"+e.getMessage());  
        }  
        return i;  
    }  
    /** 
     * 关闭数据库
     */  
    
    public void closeDB() {
    	try{
    		con.close();
    	} catch (SQLException e) {
    		System.out.println("数据库关闭错误!!!"+e.getMessage());  
    	}
    	
    }
}
```

### JSP

#### login.jsp

```jsp
	<!--login.jsp-->
<%@ page language="java" contentType="text/html; chaset=utf-8" import="java.util.*" pageEncoding="UTF-8"%>
<!-- 
    上面的指令声明了页面采用的编程语言为 Java，页面编码为 UTF-8。并且导入了 java.util.* 包，可以在页面中使用该包下的所有类。
-->
<html>
    <title>用户登录</title>
    <!-- 页面标题 -->
    <body> 
        <center> <br><br/>
        <!-- 将后续元素居中对齐 -->
            <strong> <font color="#ff8040" size="5"> 欢迎使用****管理系统 </font> </strong> <br><br/>
            <!-- 加粗、改变字体颜色和大小的欢迎提示信息 -->
            <form method="post" action="check.jsp" name="lgform">
            <!-- 定义表单元素：请求方式为 POST，提交表单的目标地址为 check.jsp，表单名称为 lgform -->
                <label>用户名</label> 
                <!-- 显示文本（标签） -->
                <input type="text" name="uname" maxlength="20" size="20"/>
                <!-- 输入框：类型为 text，name 属性指定参数名，最大长度为 20，宽度为 20 个字符 -->
                <br><br/>
                <label>密&nbsp;&nbsp;&nbsp;&nbsp;码</label>
                <!--&nbsp; 空格-->
                <!-- 显示文本（标签） -->
                <input type="password" name="upwd" size="21" maxlength="20"/>
                <!-- 输入框：类型为 password，name 属性指定参数名，最大长度为 20，宽度为 21 个字符 -->
                <br><br>
                <input type="submit" value="提交" name="submit">
                <!-- 提交按钮：显示文本为“提交”，参数名为 submit -->
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
                <!-- 空格符 -->
                <input type="reset" value="取消" name="reset"><br>&nbsp;<br/>
                <!-- 重置按钮：显示文本为“取消”，参数名为 reset -->
            </form> 
        </center>
    </body>
</html>
```

#### check.jsp

```jsp
<%@ page language="java"   import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>
<%-- 定义 check.jsp 页面 --%>
<html>
  <title>check.jsp page</title>
  <body>
  <% 
    // 获取前端传递的参数 uname 和 upwd
    String uname=request.getParameter("uname");
    // 将获取的参数 uname 转换成 utf-8 编码格式
    uname=conClass.tochinese(uname);
    String upwd =request.getParameter("upwd");
    
    // 如果 uname 参数不为空，则处理登录逻辑
    if(uname!=null)
    { // 创建数据库连接对象 db，并拼接 SQL 语句
      sqlBean db = new sqlBean();
      String sql=String.format("select * from userAdmin where username='%s' and password='%s'",uname,upwd);
      // 执行 SQL 查询，并将结果集存储到变量 rs 中
      ResultSet rs=db.executeQuery(sql);
      // 如果查询结果非空，则表示登录成功
      if(rs.next())
      { // 将用户名和登录标志保存到 session 中，并跳转到主页面 main.jsp
        session.setAttribute("uname",uname);
        session.setAttribute("flag","success");//success表示登录成功
        response.sendRedirect("main.jsp");
      }
      // 如果查询结果为空，则表示用户名或密码错误，提示用户重新登录
      else
      {
       // 将登录标志设置为 fail，表示登录失败
       session.setAttribute("flag","fail"); //fail表示用户名或密码错误
       // 跳转到错误提示页面 error.jsp
       response.sendRedirect("error.jsp");
      }
      
    }
    // 如果 uname 参数为空，则表示用户没有登录，提示用户重新登录
    else
    { // 将登录标志设置为 no，表示没有登录
      session.setAttribute("flag","no");  //no表示没有登录
      // 跳转到错误提示页面 error.jsp
      response.sendRedirect("error.jsp");
    }
   %>
  </body>
</html>
```

#### main.jsp

```jsp
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%> 
<!--
    这是一个 JSP 页面，用于展示系统主界面。
    其中，@page 指令用于指定页面的语言、导入包和编码方式。
-->
<html>
    <head>
        <title>****管理系统主界面</title>  
    </head>
    <body>
        <%  
            /*
                这里使用了Java语法来执行一些动态的操作：
                - 通过 session.getAttribute 方法获取 session 中存储的 flag 和 uname 值
                - 如果 flag 的值为空或不为 "success"，则跳转到 error.jsp 页面
            */
            String flag = (String)session.getAttribute("flag");
            if(flag==null || flag!="success")
                response.sendRedirect("error.jsp");
            String uname = (String)session.getAttribute("uname");
        %> 
        <br><br>
        <!-- 这里使用 HTML 代码来构建页面的元素 -->
        <font color="#ff8000"  size="5"><strong>当前用户：<%=uname%></strong></font><br><br>
        &nbsp; &nbsp;&nbsp; <a href="infolr.jsp" target="_blank">信息录入</a> <br><br>
        &nbsp; &nbsp;&nbsp; <a href="infocx.jsp" target="_blank">信息查询</a> <br><br>
        &nbsp; &nbsp;&nbsp; <a href="userwh.jsp" target="_blank">系统维护</a> <br><br>  
        &nbsp; &nbsp;&nbsp; 其他功能<br><br>
        &nbsp; &nbsp;&nbsp;<input type="button" value="退出系统" name="button1" 
            onclick="javascript:window.location.href='exit.jsp';"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><br>

    </body>
</html>
```

#### error.jsp

```jsp
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<!--
    这是一个 JSP 页面，用于展示登录失败信息。
    其中，@page 指令用于指定页面的语言、导入包和编码方式。
-->
<html>
    <head>
        <title>登录失败</title>  
    </head>
    <body>
        <center>
            <br>
            <!-- 这里使用 Java 代码来执行一些动态的操作 -->
            <%  
                /*
                    首先通过 session.getAttribute 方法获取存储在 session 中的 flag 值，
                    根据 flag 的值判断用户是否已经登录成功或者登录失败，
                    然后展示相应的提示信息。
                */
                String flag = (String)session.getAttribute("flag");
                if(flag!=null && flag=="fail")
                    out.println("用户名或密码错误");
                else if(flag!=null && flag=="success")
                    response.sendRedirect("main.jsp");
                else
                    out.println("请您先登录");
             %>
            <br>
            <br>
            <!-- 在 HTML 中添加超链接来返回登录页面 -->
            <a href="login.jsp" target="_self">返回登录页面</a>
        </center>
    </body>
</html>
```

#### infolr.jsp 录入

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!--
    这是一个 JSP 页面，用于展示信息录入界面。
    其中，@page 指令用于指定页面的语言、内容类型和编码方式。
-->
<html>
    <head>
        <title>信息录入界面</title>
    </head>
    <body>
        <center>
            <% 
                /*
                    在页面顶部，我们通过 session.getAttribute 方法获取存储在 session 中的 flag 值，
                    根据 flag 的值判断用户是否已经登录成功，如果未登录或者登录失败，
                    则直接重定向到错误页面 error.jsp。
                */
                String flag = (String)session.getAttribute("flag");
                if(flag==null || flag!="success") response.sendRedirect("error.jsp");
                
                /*
                    在这里，我们使用 uname 变量来获取登录成功的用户名，
                    然后将其展示在欢迎信息中。需要注意的是，uname 的值是在登录成功后
                    存储在 session 中的，可以通过 session.getAttribute 方法来获取。
                */
                String uname = (String)session.getAttribute("uname");
            %>

            <br><br>
            <!-- 在页面中展示欢迎信息，包括当前登录用户和录入人信息 -->
            <strong><font color="#ff8000">欢迎来到信息录入界面！录入人：<%=uname %></font></strong><br><br>
            
            <!-- 创建一个提交表单，用户可以通过此表单输入信息并保存起来 -->
            <form method="post" action="infolr_process.jsp" name="lrform">
                学号：<input type="text" maxlength="20" size="20" name="snum">
                <br>
                
                <!-- 使用<p>标签来控制输入框的布局。 -->
                <p>姓名：<input type="text" maxlength="20" size="20" name="sname"></p>
                <p>性别：<input type="radio"  value="男" name="ssex" checked="checked"> 男&nbsp;  
                           <input type="radio"  value="女" name="ssex"> 女&nbsp;
                           &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                           <br>
                </p>
                <p>年龄：<input type="text" maxlength="20" size="20" name="sage" value="20"></p>
                <p>专业：<input type="text" maxlength="20" size="20" name="sdept"> <br></p>
                
                <!-- 创建提交按钮和重置按钮 -->
                <p><input type="submit" value="保存" name="lrbut">&nbsp;&nbsp;&nbsp;&nbsp;
                   <input type="reset" value="重填" name="resetbt"> </p>
                <p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>
            </form>
        </center>
    </body>
</html>
```

#### infolr_process.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>
<!--
    这是一个 JSP 页面，用于展示录入结果。
    其中，@page 指令用于指定页面的语言、内容类型和编码方式。
    import 指令用于导入需要使用的类库。
-->
<html>
    <head>
        <title>数据录入结果</title>
    </head>
    <body>
        <center>
            <% 
                /*
                    在页面顶部，我们通过 session.getAttribute 方法获取存储在 session 中的 flag 值，
                    根据 flag 的值判断用户是否已经登录成功，如果未登录或者登录失败，
                    则直接重定向到错误页面 error.jsp。
                */
                String flag = (String)session.getAttribute("flag");
                if(flag==null || flag!="success") response.sendRedirect("error.jsp");
                
                /*
                    在这里，我们首先获取表单提交的数据，并将其转换为中文字符集。
                    接着，如果学号不为空，就将表单数据插入到数据库中，并输出录入结果。
                    我们在执行 SQL 语句时使用了 sqlBean 类中的 executeUpdate 方法，
                    它返回一个整数表示影响的行数。如果影响行数不为0，说明数据录入成功；
                    否则说明数据录入失败。最后，我们在页面中展示录入结果。
                    如果学号为空，则直接输出错误提示信息。
                */
                String snum = conClass.tochinese(request.getParameter("snum"));
                String sname = conClass.tochinese(request.getParameter("sname"));
                String ssex = conClass.tochinese(request.getParameter("ssex"));
                int sage = Integer.parseInt(request.getParameter("sage"));
                String sdept = conClass.tochinese(request.getParameter("sdept"));

                if(snum!=null && snum.length()!=0)
                { 
                    sqlBean db = new sqlBean();
                    String sql = String.format("insert into stu values('%s','%s','%s',%d,'%s')",snum,sname,ssex,sage,sdept);
                    if(db.executeUpdate(sql)!=0) out.print("数据录入成功！");
                    else out.print("数据录入失败！");
                }
                else
                { 
                    out.print("数据录入失败！提示：学号不能为空！");
                }
            %>
            
            <br><br>
            
            <!-- 在页面中创建一个超链接，用于跳转到信息录入界面继续录入数据 -->
            <a href="infolr.jsp" target="_self">继续录入</a>
        </center>
    </body>
</html>
```

#### infocx.jsp 查询

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<!-- 指定页面的语言、内容类型和编码方式 -->
<html>
<title>信息查询界面</title>
<body>
<left>

<!-- 验证用户是否已登录 -->
<%  
  String flag = (String)session.getAttribute("flag");
  if(flag==null || flag!="success") response.sendRedirect("error.jsp");
%> 

<!-- 页面标题和欢迎语 -->
<br><br>
<strong><font color="#ff8000">欢迎来到信息查询界面！
<br><br><font color="#000000">请选择查询条件：<br><br></font></font></strong>

<!-- 提供查询表单 -->
<form method="post" action="infocx_process.jsp" name="infocxform">
<p><input type="radio" checked="checked" value="snum" name="infocxtj"> 按学号查询</p>
<p><input type="radio" value="sname" name="infocxtj"> 按姓名查询</p>
<p><input type="radio" value="sdept" name="infocxtj"> 按专业查询</p>
<p>请输入关键字：<input type="text" maxlength="20" size="20" name="cxkey"> </p>
<p>&nbsp;<input type="submit" value="   查询   " name="cxbt"></p></form><br>

</body>
</html>
```

#### infocx_process.jsp

```jsp
<%@ page language="java"  contentType="text/html;chaset=utf-8" import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>

<!-- 指定页面的语言、内容类型和编码方式，同时导入所需要的类和包 -->
<html>
<title>查询结果界面</title>
<body> 
<br>
<center>

<!-- 页面标题和欢迎语 -->
<strong><font color="#ff8000">信息查询结果<br><br></font></strong>

<!-- 用表格方式展示查询结果 -->
<table width="600" border="1" align="center">
<tbody align="center">

<!-- 列表头 -->
<tr>
<td>学号</td><td>姓名</td><td>性别</td><td>年龄</td><td>专业</td><td>操作</td>
</tr>

<%
   // 获取查询条件和关键字
   String infocxtj = conClass.tochinese(request.getParameter("infocxtj"));
   String cxkey = conClass.tochinese(request.getParameter("cxkey"));

   // 构造 SQL 语句
   String sql=String.format("select * from stu where %s like'%%%s%%'",infocxtj,cxkey);

   // 创建数据库连接对象
   sqlBean db=new sqlBean();

   // 执行 SQL 查询操作
   ResultSet rs = db.executeQuery(sql);

   // 循环读取查询结果，并将数据填充到表格中
   while(rs.next()){
 %>
<tr>
<td><%=rs.getString(1) %></td>
<td><%=rs.getString(2) %></td>
<td><%=rs.getString(3) %></td>
<td><%=rs.getInt(4) %></td>
<td><%=rs.getString(5) %></td>

<!-- 提供修改和删除链接 -->
<td><a href="infoxg.jsp?snum=<%=rs.getString(1)%>" target="_self">修改</a> 
|<a href="infodelete.jsp?snum=<%=rs.getString(1)%>" target="_self">删除</a> </td>
</tr>
<%}%>
</tbody></table><br>
  <br>

  <!-- 提供返回链接 -->
  <a href="infocx.jsp" target="_self">返回</a>
</body>
</html>
```

#### infoxg.jsp 修改

```jsp
<%@ page language="java" contentType="text/html;chaset=utf-8" import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>
<html>
<title>信息修改界面</title>
<body>
 <center>

 <!-- 验证用户是否已登录 -->
 <%  
  String flag = (String)session.getAttribute("flag");
  if(flag==null || flag!="success") response.sendRedirect("error.jsp");
 %> 

 <!-- 获取要修改的学生信息 -->
 <% 
  String snum = conClass.tochinese(request.getParameter("snum"));
  String sql=String.format("select * from stu where snum ='%s'",snum);
  sqlBean db=new sqlBean();
  ResultSet rs = db.executeQuery(sql);
  rs.next();
 %>

 <!-- 页面标题 -->
     <br><br>
     <strong><font color="#ff8000">欢迎来到信息修改界面！</font></strong><br><br>

 <!-- 提供修改表单 -->
     <form method="post" action="infoxg_process.jsp" name="xgform">
     学号：<input type="text" maxlength="20" size="20" name="snum" value=<%=snum%> readonly="readonly">

     <!-- 显示当前学生信息，并允许修改 -->
     <br><p>姓名：<input type="text" maxlength="20" size="20" name="sname" value=<%=rs.getString(2)%>></p>
     <p>性别：<input type="text" maxlength="20" size="20" name="ssex" value=<%=rs.getString(3)%>> <br></p>
     <p>年龄：<input type="text" maxlength="20" size="20" name="sage" value=<%=rs.getInt(4) %>></p>
     <p>专业：<input type="text" maxlength="20" size="20" name="sdept" value=<%=rs.getString(5) %>> <br></p>
     <p><input type="submit" value="确定" name="lrbut">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>
     <p>&nbsp;</p>
     <p>&nbsp;</p>
     <p>&nbsp; </p>
     </form>  
</body>
</html>
```

#### infoxg_process.jsp

```jsp
<%@ page language="java"  contentType="text/html;chaset=utf-8" import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>
<html>
<title>数据更新结果</title>
<body>
<center>

<!-- 验证用户是否已登录 -->
<br><br>
<%  
  String flag = (String)session.getAttribute("flag");
  if(flag==null || flag!="success") response.sendRedirect("error.jsp");//合法登录验证
 %> 

<!-- 获取表单数据并进行数据更新 -->
<% 
  // 接收表单数据并转码
  String snum = conClass.tochinese(request.getParameter("snum"));
  String sname = conClass.tochinese(request.getParameter("sname"));
  String ssex = conClass.tochinese(request.getParameter("ssex"));
  int sage = Integer.parseInt(request.getParameter("sage"));
  String sdept = conClass.tochinese(request.getParameter("sdept"));

  if(snum!=null && snum.length()!=0)
  { 
    // 连接数据库，并执行更新操作
    sqlBean db = new sqlBean();
    String sql=String.format("update stu set sname='%s',ssex='%s',sage=%d,sdept='%s' where snum='%s'",sname,ssex,sage,sdept,snum);
    if(db.executeUpdate(sql)!=0) out.print("数据修改成功！");
    else out.print("数据修改失败！");
  }
  else
  { 
    out.print("数据修改失败！");
  } 
 %> 

<!-- 显示更新结果 -->
<br><br>
<a href="infocx.jsp" target="_self">返回查询界面</a>
</body>
</html>
```

#### infodelete.jsp 删除

```jsp
<%@ page language="java"  contentType="text/html;chaset=utf-8" import="java.util.*,java.sql.*,demo.*" pageEncoding="UTF-8"%>
<html>
<title>数据删除结果</title>
<body>
<center>

<!-- 验证用户是否已登录 -->
<br><br>
<%  
  String flag = (String)session.getAttribute("flag");
  if(flag==null || flag!="success") response.sendRedirect("error.jsp");//合法登录验证
 %> 

<!-- 获取超链接传递的数据并进行数据删除 -->
<% 
  // 接收超链接传递的数据并转码
  String snum = conClass.tochinese(request.getParameter("snum"));
  String sql=String.format("delete  from stu where snum='%s'",snum);

  if(snum!=null && snum.length()!=0)
  { 
    // 连接数据库，并执行删除操作
    sqlBean db = new sqlBean();
    if(db.executeUpdate(sql)!=0) out.print("数据删除成功！");
    else out.print("数据删除失败！");
  }
%>

<!-- 显示删除结果 -->
<br><br>
<a href="infocx.jsp" target="_self">返回查询界面</a>
</body>
</html>
```

#### userwh.jsp 维护

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"  pageEncoding="UTF-8"%>
<html>
<title>系统维护页面</title>
<body> 

<!-- 提示页面的功能 -->
    本页应完成对登录人员进行增、删、密码修改等操作！自己扩展！<br> </br>

</body>
</html>
```

#### 登录人员管理页面 usergl.jsp

可以记录最后一次登录的时间

#### exit.jsp 关闭

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<html>
<title>Insert title here</title>
<body>

<!-- 清除用户登录信息 -->
  <%  
    session.invalidate();  // 清除session中的信息
    response.sendRedirect("login.jsp");  // 重定向到登录页面
  %>

</body>
</html>
```

## 

```
src
	com
		sisq
			dao 
			po
			service
			test
			utils
			
web
	WEB-INF
	
```

```
登录
	注册
		图书管理 用户管理
			
```

## 链接互相跳转

```jsp
        <a href="login.jsp">返回登录</a>
后面都修改为post
<form method="post" action="useradd_process.jsp" name="useradd">
     用户名：<input type="text" maxlength="20" size="20" name="uname" value="" >
```

后面有时间添加书籍链接。

top界面增加用户名信息

```jsp
<%--         <% --%>
//         String name=request.getParameter("name");
<%--         %> --%>
<!--         <p>欢迎你！用户：</p> -->
<%--         <% --%>
//        	out.print(name);
<%--         %> --%>

<%-- <% --%>
// String username = request.getParameter("username");
<%-- %> --%>
<%--     	<jsp:forward page="user_top.jsp"> --%>
<%-- 			<jsp:param name="name" value="<%=username%>"/> --%>
<%-- 		</jsp:forward> --%>
```



## 返回上一个页面的操作

```jsp
<div id="before">
    <a href="javascript: window.history.go(-1)">返回上一级</a>
</div>
```

## 送信息

```jsp
	<a href="admin_book_update.jsp?bookid=<%=rs.getString(1)%>"target="_self">修改此图书信息</a>  <br>
```

## 自动跳转+传递参数

```java
     	response.sendRedirect("login.jsp");
//                     response.sendRedirect("admin_home.jsp");
					String temp= java.net.URLEncoder.encode(flag.toString(),"utf-8");
                    response.sendRedirect("admin_home.jsp?test="+temp);
```

```java
  String flag = (String)session.getAttribute("flag");
  if(flag==null || flag!="success") response.sendRedirect("error.jsp");
```



- - 


## login.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" pageEncoding="UTF-8" %>
<%
// 获取绝对路径路径, 开发项目一定要使用绝对路径，不然肯定出错
String path = request.getContextPath();  // 获取当前web应用的上下文路径
System.out.println(path);
String basePath = request.getScheme() + "://" + request.getServerName() + ":" 
                  + request.getServerPort() + path + "/";  // 完整的基础路径
System.out.println(basePath);  // 输出基础路径，用于调试和检查
%>
<!DOCTYPE html>
<html>
<head>
    <base href="<%=basePath%>" />  <!-- 设置页面中所有相对路径的基础路径 -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>用户登录</title>
    <!-- 页面样式部分 -->
    <style type="text/css">
        h1 {
            text-align: center;
        }
        h4 {
            text-align: center;color: red;
        }
        body {
            background-color: antiquewhite;
            background-image: url(https://images.pexels.com/photos/1646753/pexels-photo-1646753.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2); /* 设置背景图片 */
        }
        a:link, a:visited { /* 链接的样式 */
            text-decoration: none;font-size: 20px;color: black;
        }
        a:hover {
            text-decoration: underline;font-size: 24px;color: red;
        }
        input[type=text], input[type=password] {
            font-size: 16px; /* 统一设置输入框字体大小 */
            border-radius: 5px; /* 圆角边框 */
            border: none; /* 去掉默认边框 */
            padding: 5px; /* 设置输入框内边距 */
        }
    </style>
</head>
<body>
<!-- 用户登录表单 -->
<form action="login_do_info.jsp" method="post">
    <h1>用户登录</h1>
    <hr/>
    <table align="center">
        <!-- 用户名输入框 -->
        <tr>
            <td>账号：</td>
            <td><input type="text" name="username" id="username" 
                       placeholder="请输入您的账号" autofocus="autofocus"></td>
        </tr>
        <!-- 密码输入框 -->
        <tr>
            <td>密码：</td>
            <td><input type="password" name="password" id="password" 
                       placeholder="请输入您的密码"></td>
            <td><a href="search_password.jsp">找回密码</a></td>
        </tr>
        <!-- 操作按钮 -->
        <tr>
            <td colspan="1"></td>
            <td>
                <input type="submit" value="登录"/> <!-- 提交按钮 -->
                <input type="reset" value="重置"/> <!-- 重置按钮 -->
                <a href="register.jsp" target="_blank">注册</a> <!-- 注册链接 -->
            </td>
        </tr>
    </table>
</form>
</body
</html>
```



## 补充功能

在上一单元基础上进行功能扩展,参考其他网站或用过的系统：增加或补充其它功能。

*思政环节：**“先完成，再完美”**，设计时要统筹考虑功能与进度，合理安排时间；另外，遇到问题时要具有战胜困难的勇气和决心，也要有灵活的处理方法。

功能扩展方向

方向一：

单纯的HTML语言的扩展应用，即：界面美化，如：**布局**、**颜色**、**背景**、**框架**、**友情链接**等等 

方向二：

与数据库相关功能扩展，即：对数据库的增删改查，如：**系统维护**、多条件综合查询、**排序**、**权限设置管理**、**留言本**等等；

数据库操作三分

界面美化两分

## 图书馆管理项目 library

功能：

- 主页
  - 登入（可以**登录**为普通用户和管理员账户)
  - 找回密码（根据注册信息**找**回自己的密码）
  - 注册（注册的为普通用户，**增加**）

- 用户
  - 查看所有图书的**详细信息**
  - **查询**特定图书
  - **添加**评论
- 管理员
  - 账号
    - **添加**管理员账号
    - **删除**任意账号
    - **修改**账号信息
  - 图书
    - **增加**图书
    - **删除**图书
    - **修改**图书信息
    - **添加**评论
    - **删除**评论
- 头部信息
  - **显示**用户名
  - 安全**登出**账户
  - **返回**主页面
