一件事要么坚持做完，要么就不做，不要浪费自己的时间却没有任何收获。

# 计算机网络

## 第一章 概论

### 1.1 什么是Internet？

#### *组成角度*

#### 网络（network）

由节点（主机节点，数据交互节点），边（链路），协议组成。

- 数以亿计的，互联的计算设备
  - 主机（host）= 端系统
  - 运行网络应用程序
- 通信链路
  - 光纤，同轴光缆，无线电，卫星
  - 传输速率=带宽（bps）
- 分组交换设备：转发分组（Packets）
  - 路由器和交换机

是一组具有通信能力的设备相互连接而形成的。

#### 互联网（Internet）

由两个或多个网络连接起来的组合。

#### 什么是协议？

协议定义了两个或多个通信实体之间交换的**报文格式**和**次序**，以及在报文传输和/或接受或其他事件方面所采取的动作。

#### *服务角度*

- 使用通信设备进行通信的**分布式应用**。
- 通信基础设施为apps提供编程接口（同i虚拟服务）
  - 将发送和接收数据的apps与互联网连接起来

### 1.2 网络边缘

- 网络边缘

  - 主机
  - 应用程序（客户端和服务器）
- 网络核心

  - 互联着的路由器

  - 网络的网络
- 网络接入、物理媒体

  - 有线或者无线通信链路
- 端系统（主机）：
  - 运行应用程序
  - 如Web，Email

- 客户端/服务器模式
  - 客户端向服务器请求、接受服务
  - 如Web 浏览器/服务器：Email客户端/服务器

- 对等（peer-peer）模式
  - 很少专门的服务器
  - 如Gnutella、KaZaA、Emule

**采用网络设施的面向连接服务：**

- 目标：在端系统之间传输数据
  - 握手：在数据传输之前做好准备
  - TCP-传输控制协议（Transmission Control Protocol）
    - Internet上面向连接的服务
- TCP服务
  - 可靠地、按顺序地传送数据
    - 确认和重传
  - 流量控制
    - 发送方不会淹没接收方
  - 拥塞控制
    - 当网络拥塞时，发送方降低发送速率

采用基础设施的无连接服务：

目标：在端系统之间传输数据

- 无连接服务
- UDP-用户数据报协议（User Datagram Protocol）
  - 无连接
  - 不可靠数据传输
  - 无流量控制
  - 无拥塞控制
- 使用TCP的应用
  - HTTP（Web），FTP（文件传送），Telnet（远程登录），SMTP（Email）
- 使用UDP的应用
  - 流媒体、远程会议、DNS，Internet电话

### 1.3 网络核心

电路交换

- 链路带宽、交换能力
- 专用资源：不共享
- 保证性能
- 要求建立呼叫连接

网络资源（如带宽）被分成片

- 为呼叫分配片
- 如果某个呼叫没有数据，则其资源片处于空闲状态（不共享）
- 将带宽分成片
  - 频分（Frequency-division multiplexing）
  - 时分（Time-division multiplexing）
  - 波分（Wave-division multiplexing）

电路交互不适合计算机之间的通信

- 连接建立时间长
- 计算机之间的通信有突发性，如果使用线路交换，则浪费的片较多
  - 即使这个称呼没有数据传递、其所占据的片也不能够被别的呼叫使用
- 可靠性不高

分组交换

以分组为单位存储-转发方式

- 网络带宽资源不再分为一个片，传输时使用全部带宽
- 主机之间传输的数据被分为一个个分组

资源共享，按需使用

- 存储、转发：分组每次移动一跳（hop）
  - 在传法之前，节点必须收到整个分组
  - 延迟比线路交换要大
  - 排队时间

排队延迟和丢失

- 如果到达速率>链路输出速率
  - 分组将会排队，等待传输
  - 如果路由器的缓存用完了，分组将会被抛弃

网络核心的关键功能

路由：决定分组采用的源到目标的路径

- 路由算法

转发：将分组从路由器的输入链路转移到输出链路

统计多路复用

### 1.4 接入网：digital subscriber line(DSL)

线缆网络

无线链路类型：

- 地面微波
- LAN
- wide-area
- 卫星

### 1.5 Internet结构和Internet Service Provider (ISP) （International Organization for Standardization，ISO）

有一堆ISP构建起来。

### 1.6 分组延时、丢失和吞吐量

1、节点处理延时：

- 检查bit级别差错
- 检查分组首部和决定将分组导向何处

2、排队延时

- 在输出链路上等待传输的事件
- 依赖于路由器的拥塞程度

3、传输延时

4、传播延时

### 1.7 协议层次和服务模型

#### 服务和服务访问点

- 服务（Service）：底层实体向上层尸体提供它们之间的通信的能力
  - 服务用户（service user）
  - 服务提供者（service provider）
- **原语（primitive）**：上层使用下层服务的形式，高层使用低层提供的服务，以及低层西昂高层提供服务都是通过服务访问原语来进行交互的形式
- 服务访问点SAP（Services Access Point）
- 使用下层提供的服务通过层间的接口-地点

#### 面向连接的服务和无连接的服务

面向连接的服务（Connection-oriented Service）

- 连接（Connection）：两个通信实体为进行通信而建立的一种结合
- 过程：建立连接，通信，拆除连接
- 网络层的连接被成为虚电路
- 适用范围：对于大的数据块要传输；不适合小的零星报文
- 特点：保序

面向无连接的服务（Connectionless Service）

- 无连接服务：两个对等层实体在通信前不需要建立一个连接，不预留资源；不需要通信双方都是活跃；例如寄信
- 特点：不可靠、可能重复、可能失序
- IP分组，数据包
- 适用范围：适合传送零星数据

服务于协议的区别

- 服务（Service）：低层实体向上层提供它们之间的通信能力，是通过原语（Primitive）来操作的，垂直。
- 协议（Protocol）：对等层实体（peer entity)之间在相互通信的过程中，需要遵循的规则的集合，水平。

服务与协议之间的联系

- 本层协议的实现要靠下层提供的服务来实现
- 本层实体通过协议为上层提供更高级的服务

数据单元（DU）

![](https://cdn.jsdelivr.net/gh/kennems/blog-image/20230310104331.png)



### Internet协议栈

![](https://cdn.jsdelivr.net/gh/kennems/blog-image/20230310110552.png)

- 应用层：网络应用
  - 为人类用户或者其他应用进程提供网络
  - FTP，SMTP，HTTP，DNS
- 传输层：主机之间的数据传输
  - 在网络层提供的端到端通信基础之上，细分为进程到进程，将不可靠的通信变成可靠地通信
  - TCP，UDP
- 网络层：为数据报从源到目的选择路由
  - 主机之间的通信，端到端通信，不可靠
  - IP，路由协议
- 链路层：相邻网络节点间的数据传输
  - 2个相邻两点的通信，点到带你通信，可靠或不可靠
  - 点对点协议ppp,802.11(wifi),Ethernet
- 物理层：在线路上传送bit

各层次的协议数据单元

- 应用层：报文（message）
- 传输层：报文段（segment）：TCP段，UDP数据报

- 网络层：分组packet（如果无连接方式：数据包datagram）
- 数据链路层：帧（frame）
- 物理层：位（bit）

### 1.8 历史

### 小结：

## 第二章 应用层

创新一个新的网络应用

编程 

- 在不同端系统上运行
- 通过网络基础设施提供的服务，应用进程彼此通信

- 如Web：
  - Web服务器软件与浏览器软件通信

网络核心中没有应用层软件

- 网络核心没有应用层功能
- 网络应用旨在端系统上存在，快速网络应用开发和部署

可能的应用架构

- 客户-服务器模式(C/S:client/server)
- 对等模式（P2P:Peer To Peer)
- 混合体：客户-服务器和对等体系结构

### 分布式进程通信需要解决的问题

#### 问题一、对进程进行编址（addressing）

进程为了接受报文，

#### 问题二、传输层提供的服务-需要穿过层间的信息

用代号标示通信的双方或者单方：socket

- 像os打开文件返回的句柄以一样
  - 对句柄的操作，就是对文件的操作

- TCP socket
  - TCP服务，两个进程之间的通信需要之前要建立连接
    - 两个进程通信会持续一段时间，通信关系稳定
  - 可以用一个整数表示两个应用实体之间的通信关系
  - 穿过层间接口的信息量最小
  - TCP socket：源IP，源端口，目标IP，目标端口

### Web与HTTP

一些术语

- Web页：有一些对象组成
- 对象可以输HTML文件、JPEG图像、JAVA程序、声音剪辑文件

- Web也含有一个基本的HTML文件，改基本HTML文件包含若干对象的引用（链接）
- 通过URL对每个对象进行引用
- URL格式

```
Prot://user:psw@www.someSchool.edu/someDept/pic.fgif:port
```

### HTTP连接

非持久HTTP

- 最多只有一个对象在TCP连接上发送
- 下载多个对象需要多个TCP连接
- HTTP/1.0使用非持久连接

持久HTTP

- 多个对象可以在一个（在客户端和服务器之间的）TCP连接上传输
- HTTP/1.1默认使用持久连接

### HTTP请求报文

### HTTP响应报文

### 2.5 DNS(Domain Name System)

### Socket编程

## 第三章 运输层

TCP复用解复用

进程与进程之间的逻辑的通信。

依靠端口号复用和解复用

滑动窗口

1、Go Back N

非累计确认

2、Selective Repeat

### 3、6 拥塞控制

#### ATM ABR拥塞控制

**网络辅助的拥塞控制**

ATM网络（银行行业使用）

ABR(Available Bit Rate)：

- 弹性服务
- 如果发送端的路径“轻载”
  - 发送方可以使用带宽
- 如果发送方的路径拥塞了
  - 发送方限制其发送的速度到一个最小保障速率上

RM(资源管理)信元：

- 由发送端发送，再数据信元中间隔插入
- RM信元中的比特被交换机设置（“网络辅助”）
  - NI bit : no increase in rate(轻微拥塞)速率不要增加
  - CI bit : congestion indication 拥塞指示
- 发送端发送的RM信元被接收端返回，接收端不做任何改变

#### TCP 拥塞控制

- **端到端的拥塞控制**
  - 路由器不想注意有关拥塞的反馈信息
  - 符合网络核心简单的TCP/IP架构原则
- 端系统根据自身得到的信息，判断是否发生拥塞，从而采取动作

通过冗余ACK，超时来判断拥塞

- 当CongWin<Threshold，发送端处于慢启动阶段(slow-start)，窗口指数型增长
- 当CongWin>Threshold，发送端处于拥塞避免阶段(congestion-avoidance)，窗口线性增长
- 当收到三个重复的ACKs（triple duplicate ACK）Threshold设置成CongWin/2
  CongWin=Threshold+3
- 当超时时间发生时timeout，Threshold=CongWin/2
  CongWin=1 MSS， 进入**SS阶段**
